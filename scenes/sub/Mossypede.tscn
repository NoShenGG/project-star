[gd_scene load_steps=21 format=3 uid="uid://celvhgttbuade"]

[ext_resource type="Script" uid="uid://b3r7iadvf8jmk" path="res://scripts/entities/enemies/mossypede/Mossypede.gd" id="1_wqp5f"]
[ext_resource type="Script" uid="uid://dcfoaiv83pvo4" path="res://scripts/utility/states/state_machine.gd" id="2_kejld"]
[ext_resource type="PackedScene" uid="uid://pv4ghgiiejhk" path="res://scenes/dev/christian_d/enemy_status_bar.tscn" id="2_qufj0"]
[ext_resource type="PackedScene" uid="uid://bbhdok14mvale" path="res://art_assets/enemies/mossypede/mossypede.glb" id="2_sxa4w"]
[ext_resource type="Script" uid="uid://14v6se6ehp7y" path="res://scripts/entities/enemies/states/enemy_wait.gd" id="3_vv04i"]
[ext_resource type="Script" uid="uid://irxuylaptnty" path="res://scripts/entities/enemies/states/dead.gd" id="4_35qt8"]
[ext_resource type="Script" uid="uid://wjug80utd1ei" path="res://scripts/entities/enemies/mossypede/mossypede_attack.gd" id="4_vv04i"]
[ext_resource type="PackedScene" uid="uid://c3hpdu6n1fa6d" path="res://scenes/dev/anth/dissolveFX.tscn" id="8_2xbfi"]
[ext_resource type="Script" uid="uid://bjlnudp8j65ma" path="res://scripts/entities/animation_state.gd" id="8_35qt8"]

[sub_resource type="SphereShape3D" id="SphereShape3D_vv04i"]
radius = 0.25

[sub_resource type="BoxShape3D" id="BoxShape3D_l26uf"]
size = Vector3(1.435, 1, 1.72)

[sub_resource type="ViewportTexture" id="ViewportTexture_g0rg0"]
viewport_path = NodePath("SubViewport")

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_2xbfi"]
animation = &"end_roll"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_voujk"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_x407m"]
animation = &"rolling"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_d5nqh"]
animation = &"start_roll"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_qufj0"]
animation = &"walk"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_8wr4x"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_1e61x"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_kejld"]
states/End/position = Vector2(1191, 90)
states/Start/position = Vector2(183, 115)
states/end_roll/node = SubResource("AnimationNodeAnimation_2xbfi")
states/end_roll/position = Vector2(781.71387, 13.038467)
states/idle/node = SubResource("AnimationNodeAnimation_voujk")
states/idle/position = Vector2(372, 177.96153)
states/rolling/node = SubResource("AnimationNodeAnimation_x407m")
states/rolling/position = Vector2(629.7139, 110)
states/start_roll/node = SubResource("AnimationNodeAnimation_d5nqh")
states/start_roll/position = Vector2(518.7139, 110)
states/walk/node = SubResource("AnimationNodeAnimation_qufj0")
states/walk/position = Vector2(372, 110)
transitions = ["end_roll", "walk", SubResource("AnimationNodeStateMachineTransition_8wr4x"), "start_roll", "rolling", SubResource("AnimationNodeStateMachineTransition_1e61x")]
graph_offset = Vector2(142.71394, -2.0384636)

[node name="Mossypede" type="CharacterBody3D"]
collision_layer = 10
collision_mask = 3
script = ExtResource("1_wqp5f")
attack_cd = 4.0
hit_dmg = 0.5
attack_radius = 2.0
_base_speed = 10.0

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("2_kejld")
initial_state = NodePath("Cooldown")
metadata/_custom_type_script = "uid://dcfoaiv83pvo4"

[node name="Cooldown" type="Node" parent="StateMachine" node_paths=PackedStringArray("post_wait_state", "player_far_state")]
script = ExtResource("3_vv04i")
wait_time = 2.0
post_wait_state = NodePath("../Attacking")
max_player_distance = 16.0
player_far_state = NodePath("../WaitForPlayer")

[node name="WaitForPlayer" type="Node" parent="StateMachine" node_paths=PackedStringArray("player_close_state")]
script = ExtResource("3_vv04i")
rotate_to_player = false
max_player_distance = 15.0
player_close_state = NodePath("../Cooldown")

[node name="Attacking" type="Node" parent="StateMachine" node_paths=PackedStringArray("reached_state")]
script = ExtResource("4_vv04i")
reached_state = NodePath("../Cooldown")

[node name="RollingSFX" type="FmodEventEmitter3D" parent="StateMachine/Attacking"]
event_name = "event:/Enemys/RollyPolly/RollyPolly Roll"
event_guid = "{8b99d305-3830-47f0-b782-ff00bbd394da}"

[node name="Dead" type="Node" parent="StateMachine"]
script = ExtResource("4_35qt8")

[node name="Cast" type="ShapeCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.35, 0)
shape = SubResource("SphereShape3D_vv04i")
target_position = Vector3(0, 0, -10)
collide_with_areas = true

[node name="mossypede" parent="." instance=ExtResource("2_sxa4w")]
transform = Transform3D(50, 0, 0, 0, 50, 0, 0, 0, 50, 0, 0, 0)

[node name="Skeleton3D" parent="mossypede" index="0"]
bones/2/rotation = Quaternion(-0.008669642, 0.70705366, -0.008669642, 0.7070536)
bones/3/position = Vector3(0.004338014, 0, 0)
bones/3/rotation = Quaternion(0.00037973217, 0.017682701, -0.021466475, 0.99961317)
bones/4/position = Vector3(0.0039445297, 0, 0)
bones/4/rotation = Quaternion(-0.00041943238, -0.029815754, -0.0140598295, 0.9994565)
bones/5/position = Vector3(0.0039001813, 0, 0)
bones/5/rotation = Quaternion(-0.00024917937, -0.006101909, -0.040801547, 0.99914867)
bones/6/position = Vector3(0.0036199747, 0, 0)
bones/6/rotation = Quaternion(2.4528063e-05, -0.019213678, 0.0012763571, 0.99981457)
bones/9/position = Vector3(0.0046078106, 2.1878208e-05, 3.3017855e-05)
bones/9/rotation = Quaternion(-0.043773424, 0.053647902, -0.2493595, 0.96593255)
bones/10/position = Vector3(0.0032920872, 1.2404124e-05, 2.2668677e-05)
bones/10/rotation = Quaternion(-0.006280834, 0.12930293, -0.006016448, 0.9915671)
bones/12/position = Vector3(-0.003318063, -0.00018778043, 0)
bones/12/rotation = Quaternion(-0.05710878, 0.99836355, -0.00017144416, -0.0029971504)
bones/13/position = Vector3(0.005339815, 0, 0)
bones/13/rotation = Quaternion(0.0010022807, 0.021267435, -0.047064576, 0.998665)
bones/14/position = Vector3(0.0046522375, 0, 0)
bones/14/rotation = Quaternion(0.0019819331, -0.039664958, -0.049865223, 0.9979661)
bones/15/position = Vector3(0.0039887396, 0, 0)
bones/15/rotation = Quaternion(0.0007011907, 0.04123781, -0.016986664, 0.9990048)

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
shape = SubResource("BoxShape3D_l26uf")

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="."]
debug_path_custom_color = Color(0, 1, 0, 1)

[node name="StatusBars" parent="." instance=ExtResource("2_qufj0")]
transform = Transform3D(0.70710677, -0.4055798, 0.579228, 0, 0.81915206, 0.57357645, -0.70710677, -0.4055798, 0.579228, 0, 2.035, 0)
texture = SubResource("ViewportTexture_g0rg0")

[node name="DissolveFX" parent="." node_paths=PackedStringArray("meshes") instance=ExtResource("8_2xbfi")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
dissolveDuration = 1.0
meshes = [NodePath("../mossypede/Skeleton3D/model_Back"), NodePath("../mossypede/Skeleton3D/model_Body")]

[node name="AnimationTree" type="AnimationTree" parent="."]
root_node = NodePath("../mossypede")
tree_root = SubResource("AnimationNodeStateMachine_kejld")
anim_player = NodePath("../mossypede/AnimationPlayer")

[node name="idle" type="Node" parent="AnimationTree"]
script = ExtResource("8_35qt8")
state_name = "idle"
animation_tree = Object(AnimationTree,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="walk" type="Node" parent="AnimationTree"]
script = ExtResource("8_35qt8")
state_name = "walk"
animation_tree = Object(AnimationTree,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="WalkSFX" type="FmodEventEmitter3D" parent="AnimationTree/walk"]
event_name = "event:/Enemys/RollyPolly/RollyPolly Crawl"
event_guid = "{59579045-d71f-4fed-bd9d-bc55d6b799f7}"

[node name="start_roll" type="Node" parent="AnimationTree"]
script = ExtResource("8_35qt8")
state_name = "start_roll"
animation_tree = Object(AnimationTree,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="roll" type="Node" parent="AnimationTree"]
script = ExtResource("8_35qt8")
state_name = "rolling"
animation_tree = Object(AnimationTree,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="end_roll" type="Node" parent="AnimationTree"]
script = ExtResource("8_35qt8")
state_name = "end_roll"
animation_tree = Object(AnimationTree,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="HurtSFX" type="FmodEventEmitter3D" parent="."]
event_name = "event:/Enemys/RollyPolly/RollyPolly hurt"
event_guid = "{b2e2dc76-1032-46f7-bd6e-bad6813cc497}"

[connection signal="break_update" from="." to="StatusBars" method="update_break"]
[connection signal="health_update" from="." to="StatusBars" method="update_health"]
[connection signal="hurt" from="." to="HurtSFX" method="play_one_shot" unbinds=1]
[connection signal="entered" from="StateMachine/Cooldown" to="AnimationTree/idle" method="enter"]
[connection signal="entered" from="StateMachine/Attacking" to="AnimationTree/start_roll" method="enter"]
[connection signal="entered" from="StateMachine/Attacking" to="StateMachine/Attacking/RollingSFX" method="play" binds= [true]]
[connection signal="finished" from="StateMachine/Attacking" to="StateMachine/Attacking/RollingSFX" method="stop"]
[connection signal="finished" from="StateMachine/Attacking" to="AnimationTree/end_roll" method="enter"]
[connection signal="entered" from="StateMachine/Dead" to="DissolveFX" method="beginDissolve"]
[connection signal="start" from="AnimationTree/walk" to="AnimationTree/walk/WalkSFX" method="play" binds= [true]]
[connection signal="stop" from="AnimationTree/walk" to="AnimationTree/walk/WalkSFX" method="stop"]

[editable path="mossypede"]
