[gd_scene format=3 uid="uid://celvhgttbuade"]

[ext_resource type="Script" uid="uid://b3r7iadvf8jmk" path="res://scripts/entities/enemies/mossypede/Mossypede.gd" id="1_wqp5f"]
[ext_resource type="Script" uid="uid://dcfoaiv83pvo4" path="res://scripts/utility/states/state_machine.gd" id="2_kejld"]
[ext_resource type="PackedScene" uid="uid://pv4ghgiiejhk" path="res://scenes/dev/christian_d/enemy_status_bar.tscn" id="2_qufj0"]
[ext_resource type="PackedScene" uid="uid://bbhdok14mvale" path="res://art_assets/enemies/mossypede/mossypede.glb" id="2_sxa4w"]
[ext_resource type="Script" uid="uid://14v6se6ehp7y" path="res://scripts/entities/enemies/states/enemy_wait.gd" id="3_vv04i"]
[ext_resource type="Script" uid="uid://irxuylaptnty" path="res://scripts/entities/enemies/states/dead.gd" id="4_35qt8"]
[ext_resource type="Script" uid="uid://wjug80utd1ei" path="res://scripts/entities/enemies/mossypede/mossypede_attack.gd" id="4_vv04i"]
[ext_resource type="Script" uid="uid://bjlnudp8j65ma" path="res://scripts/entities/animation_state.gd" id="8_35qt8"]
[ext_resource type="Script" uid="uid://bk677e0jvjhsw" path="res://scripts/entities/HurtVFX.gd" id="9_y5q3u"]
[ext_resource type="Script" uid="uid://hrugoc51xhma" path="res://vfx/AutoStartVFX.gd" id="10_5ax67"]
[ext_resource type="Texture2D" uid="uid://qj1lsmefhhje" path="res://vfx/Kenny Particle Pack/circle_05.png" id="11_susbl"]
[ext_resource type="Script" uid="uid://b7pj5dra8sjgx" path="res://scripts/entities/DeathVFX.gd" id="12_n5wuq"]
[ext_resource type="Script" uid="uid://dxy6p70rncayl" path="res://scripts/entities/SpawnVFX.gd" id="13_r6f51"]
[ext_resource type="PackedScene" uid="uid://dtrpcl1nasika" path="res://vfx/enemySummonFX.tscn" id="14_8wr4x"]

[sub_resource type="SphereShape3D" id="SphereShape3D_vv04i"]
radius = 0.25

[sub_resource type="BoxShape3D" id="BoxShape3D_l26uf"]
size = Vector3(1.435, 1, 1.72)

[sub_resource type="ViewportTexture" id="ViewportTexture_i1plq"]
viewport_path = NodePath("SubViewport")

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_2xbfi"]
animation = &"end_roll"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_voujk"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_x407m"]
animation = &"rolling"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_d5nqh"]
animation = &"start_roll"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_qufj0"]
animation = &"walk"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_8wr4x"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_1e61x"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_kejld"]
states/End/position = Vector2(1191, 90)
states/Start/position = Vector2(183, 115)
states/end_roll/node = SubResource("AnimationNodeAnimation_2xbfi")
states/end_roll/position = Vector2(781.71387, 13.038467)
states/idle/node = SubResource("AnimationNodeAnimation_voujk")
states/idle/position = Vector2(372, 177.96153)
states/rolling/node = SubResource("AnimationNodeAnimation_x407m")
states/rolling/position = Vector2(629.7139, 110)
states/start_roll/node = SubResource("AnimationNodeAnimation_d5nqh")
states/start_roll/position = Vector2(518.7139, 110)
states/walk/node = SubResource("AnimationNodeAnimation_qufj0")
states/walk/position = Vector2(372, 110)
transitions = ["end_roll", "walk", SubResource("AnimationNodeStateMachineTransition_8wr4x"), "start_roll", "rolling", SubResource("AnimationNodeStateMachineTransition_1e61x")]
graph_offset = Vector2(142.71394, -2.0384636)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_v61s5"]
transparency = 1
blend_mode = 1
shading_mode = 0
albedo_color = Color(1, 1, 1, 0.59607846)

[sub_resource type="Curve" id="Curve_mea5v"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_m4apj"]
curve = SubResource("Curve_mea5v")

[sub_resource type="Curve" id="Curve_xga3k"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), -2.7659185, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_n7xiu"]
curve = SubResource("Curve_xga3k")

[sub_resource type="Curve" id="Curve_8ms2u"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), -3.057878, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_bn177"]
curve = SubResource("Curve_8ms2u")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_k0vju"]
direction = Vector3(0, 0.5, 1)
initial_velocity_min = 6.0
initial_velocity_max = 10.0
scale_min = 0.79999995
scale_max = 1.3
scale_curve = SubResource("CurveTexture_bn177")
alpha_curve = SubResource("CurveTexture_m4apj")
emission_curve = SubResource("CurveTexture_n7xiu")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_4u8kd"]
transparency = 1
shading_mode = 0
vertex_color_use_as_albedo = true
albedo_texture = ExtResource("11_susbl")
billboard_mode = 3
billboard_keep_scale = true
particles_anim_h_frames = 1
particles_anim_v_frames = 1
particles_anim_loop = false

[sub_resource type="QuadMesh" id="QuadMesh_xo2t7"]
material = SubResource("StandardMaterial3D_4u8kd")

[sub_resource type="Curve" id="Curve_7tk13"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), -3.057878, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_cqf5t"]
curve = SubResource("Curve_7tk13")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_irvss"]
direction = Vector3(0, 1, 0)
spread = 85.0
initial_velocity_min = 6.0
initial_velocity_max = 10.0
scale_min = 0.79999995
scale_max = 1.3
scale_curve = SubResource("CurveTexture_cqf5t")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_lyyx5"]
transparency = 1
shading_mode = 0
albedo_color = Color(1, 0, 0, 0)

[node name="Mossypede" type="CharacterBody3D" unique_id=1040683952]
collision_layer = 10
collision_mask = 3
script = ExtResource("1_wqp5f")
attack_cd = 4.0
hit_dmg = 0.5
attack_radius = 2.0
_base_speed = 10.0

[node name="StateMachine" type="Node" parent="." unique_id=814444490 node_paths=PackedStringArray("initial_state")]
script = ExtResource("2_kejld")
initial_state = NodePath("Cooldown")
metadata/_custom_type_script = "uid://dcfoaiv83pvo4"

[node name="Cooldown" type="Node" parent="StateMachine" unique_id=1187835387 node_paths=PackedStringArray("post_wait_state", "player_far_state")]
script = ExtResource("3_vv04i")
wait_time = 2.0
post_wait_state = NodePath("../Attacking")
max_player_distance = 16.0
player_far_state = NodePath("../WaitForPlayer")

[node name="WaitForPlayer" type="Node" parent="StateMachine" unique_id=2144065659 node_paths=PackedStringArray("player_close_state")]
script = ExtResource("3_vv04i")
rotate_to_player = false
max_player_distance = 15.0
player_close_state = NodePath("../Cooldown")

[node name="Attacking" type="Node" parent="StateMachine" unique_id=1901971670 node_paths=PackedStringArray("reached_state")]
script = ExtResource("4_vv04i")
reached_state = NodePath("../Cooldown")

[node name="RollingSFX" type="FmodEventEmitter3D" parent="StateMachine/Attacking" unique_id=1215464848]
event_name = "event:/Enemys/RollyPolly/RollyPolly Roll"
event_guid = "{8b99d305-3830-47f0-b782-ff00bbd394da}"

[node name="Dead" type="Node" parent="StateMachine" unique_id=1487674572]
script = ExtResource("4_35qt8")

[node name="Cast" type="ShapeCast3D" parent="." unique_id=796131452]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.35, 0)
shape = SubResource("SphereShape3D_vv04i")
target_position = Vector3(0, 0, -10)
collide_with_areas = true

[node name="mossypede" parent="." unique_id=2071207216 instance=ExtResource("2_sxa4w")]
transform = Transform3D(50, 0, 0, 0, 50, 0, 0, 0, 50, 0, 0, 0)

[node name="CollisionShape3D" type="CollisionShape3D" parent="." unique_id=932990000]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
shape = SubResource("BoxShape3D_l26uf")

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="." unique_id=1790809301]
debug_path_custom_color = Color(0, 1, 0, 1)

[node name="StatusBars" parent="." unique_id=230721279 instance=ExtResource("2_qufj0")]
transform = Transform3D(0.70710677, -0.4055798, 0.579228, 0, 0.81915206, 0.57357645, -0.70710677, -0.4055798, 0.579228, 0, 2.035, 0)
texture = SubResource("ViewportTexture_i1plq")

[node name="AnimationTree" type="AnimationTree" parent="." unique_id=981870473]
root_node = NodePath("../mossypede")
tree_root = SubResource("AnimationNodeStateMachine_kejld")
anim_player = NodePath("../mossypede/AnimationPlayer")

[node name="idle" type="Node" parent="AnimationTree" unique_id=156636396]
script = ExtResource("8_35qt8")
state_name = "idle"
animation_tree = Object(AnimationTree,"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="walk" type="Node" parent="AnimationTree" unique_id=192471825]
script = ExtResource("8_35qt8")
state_name = "walk"
animation_tree = Object(AnimationTree,"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="WalkSFX" type="FmodEventEmitter3D" parent="AnimationTree/walk" unique_id=2099378401]
event_name = "event:/Enemys/RollyPolly/RollyPolly Crawl"
event_guid = "{59579045-d71f-4fed-bd9d-bc55d6b799f7}"

[node name="start_roll" type="Node" parent="AnimationTree" unique_id=308604984]
script = ExtResource("8_35qt8")
state_name = "start_roll"
animation_tree = Object(AnimationTree,"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="roll" type="Node" parent="AnimationTree" unique_id=1240589243]
script = ExtResource("8_35qt8")
state_name = "rolling"
animation_tree = Object(AnimationTree,"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="end_roll" type="Node" parent="AnimationTree" unique_id=1710289086]
script = ExtResource("8_35qt8")
state_name = "end_roll"
animation_tree = Object(AnimationTree,"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","active":true,"deterministic":true,"reset_on_save":true,"root_node":NodePath("../mossypede"),"root_motion_track":NodePath(""),"root_motion_local":false,"audio_max_polyphony":32,"callback_mode_process":1,"callback_mode_method":0,"callback_mode_discrete":2,"tree_root":SubResource("AnimationNodeStateMachine_kejld"),"advance_expression_base_node":NodePath("."),"anim_player":NodePath("../mossypede/AnimationPlayer"),"script":null)


[node name="HurtSFX" type="FmodEventEmitter3D" parent="." unique_id=388266820]
event_name = "event:/Enemys/RollyPolly/RollyPolly hurt"
event_guid = "{b2e2dc76-1032-46f7-bd6e-bad6813cc497}"

[node name="Hurt" type="Node3D" parent="." unique_id=1527455768 node_paths=PackedStringArray("vfx", "meshes_root")]
script = ExtResource("9_y5q3u")
vfx = NodePath("Hurt VFX")
meshes_root = NodePath("../mossypede")
hurt_overlay = SubResource("StandardMaterial3D_v61s5")
flash_duration = 0.5

[node name="Hurt VFX" type="Node3D" parent="Hurt" unique_id=559643387 node_paths=PackedStringArray("particles")]
script = ExtResource("10_5ax67")
particles = [NodePath("GPUParticles3D"), NodePath("GPUParticles3D")]
metadata/_custom_type_script = "uid://hrugoc51xhma"

[node name="GPUParticles3D" type="GPUParticles3D" parent="Hurt/Hurt VFX" unique_id=837050648]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.4, 0.050730154)
emitting = false
lifetime = 0.5
one_shot = true
explosiveness = 1.0
process_material = SubResource("ParticleProcessMaterial_k0vju")
draw_pass_1 = SubResource("QuadMesh_xo2t7")

[node name="Death" type="Node3D" parent="." unique_id=558960281 node_paths=PackedStringArray("vfx", "meshes_root")]
script = ExtResource("12_n5wuq")
vfx = NodePath("Death VFX")
meshes_root = NodePath("../mossypede")
hurt_overlay = SubResource("StandardMaterial3D_v61s5")
flash_duration = 3.0
death_delay = 2.0
death_time = 2.0
fade_out = false

[node name="Death VFX" type="Node3D" parent="Death" unique_id=2011334205 node_paths=PackedStringArray("particles")]
script = ExtResource("10_5ax67")
particles = [NodePath("GPUParticles3D"), NodePath("GPUParticles3D")]
metadata/_custom_type_script = "uid://hrugoc51xhma"

[node name="GPUParticles3D" type="GPUParticles3D" parent="Death/Death VFX" unique_id=1453088375]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.4, 0.050730154)
emitting = false
amount = 17
lifetime = 0.5
one_shot = true
explosiveness = 1.0
process_material = SubResource("ParticleProcessMaterial_irvss")
draw_pass_1 = SubResource("QuadMesh_xo2t7")

[node name="Spawned" type="Node3D" parent="." unique_id=2113684327 node_paths=PackedStringArray("vfx", "meshes_root", "_meshes")]
process_mode = 3
script = ExtResource("13_r6f51")
vfx = NodePath("enemySummonFX")
meshes_root = NodePath("../mossypede")
_meshes = [NodePath(""), NodePath(""), NodePath(""), NodePath(""), NodePath(""), NodePath(""), NodePath(""), NodePath(""), NodePath(""), NodePath("")]
hurt_overlay = SubResource("StandardMaterial3D_lyyx5")
flash_duration = 0.75

[node name="enemySummonFX" parent="Spawned" unique_id=352876712 instance=ExtResource("14_8wr4x")]
lifetime = 1.25

[connection signal="break_update" from="." to="StatusBars" method="update_break"]
[connection signal="health_update" from="." to="StatusBars" method="update_health"]
[connection signal="hurt" from="." to="HurtSFX" method="play_one_shot" unbinds=1]
[connection signal="entered" from="StateMachine/Cooldown" to="AnimationTree/idle" method="enter"]
[connection signal="entered" from="StateMachine/Attacking" to="AnimationTree/start_roll" method="enter"]
[connection signal="entered" from="StateMachine/Attacking" to="StateMachine/Attacking/RollingSFX" method="play" binds= [true]]
[connection signal="finished" from="StateMachine/Attacking" to="StateMachine/Attacking/RollingSFX" method="stop"]
[connection signal="finished" from="StateMachine/Attacking" to="AnimationTree/end_roll" method="enter"]
[connection signal="start" from="AnimationTree/walk" to="AnimationTree/walk/WalkSFX" method="play" binds= [true]]
[connection signal="stop" from="AnimationTree/walk" to="AnimationTree/walk/WalkSFX" method="stop"]

[editable path="mossypede"]
[editable path="Spawned/enemySummonFX"]
